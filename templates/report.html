<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dosage Recommendation Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { background-color: #f8f9fa; }
        .report-container { max-width: 800px; margin: 40px auto; background-color: #fff; padding: 40px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-radius: 8px; }
        .report-header { text-align: center; border-bottom: 2px solid #dee2e6; padding-bottom: 20px; margin-bottom: 30px; }
        .report-header h1 { color: #2c3e50; }
        .section-title { font-weight: bold; color: #0d6efd; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-top: 30px; margin-bottom: 15px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .info-grid p { margin-bottom: 5px; }
        .recommendation { background-color: #e7f1ff; border-left: 5px solid #0d6efd; padding: 20px; margin-top: 20px; text-align: center; }
        .recommendation h3 { font-size: 1.2rem; color: #555; }
        .recommendation .display-4 { color: #0d6efd; }
        .suggestions { background-color: #fffbe6; border-left: 5px solid #ffc107; padding: 15px; margin-top: 30px; }
        .disclaimer { font-size: 0.8rem; color: #6c757d; margin-top: 40px; text-align: center; }
        .no-print { margin: 30px 0; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>
    <div class="report-container">
        <div class="report-header">
            <h1>Dosage Recommendation Report</h1>
            <p class="lead">GenMedix Analysis</p>
        </div>

        <h5 class="section-title">Patient Information</h5>
        <div class="info-grid">
            <p><strong>Name:</strong> {{ patient_info.patient_name }}</p>
            <p><strong>DOB:</strong> {{ patient_info.patient_dob }}</p>
            <p><strong>Gender:</strong> {{ patient_info.patient_gender }}</p>
            <p><strong>Country:</strong> {{ patient_info.patient_country }}</p>
        </div>
        
        <h5 class="section-title">Clinical & Genomic Data Provided</h5>
        <div class="info-grid">
            <p><strong>Age:</strong> {{ clinical_info.Age }} years</p>
            <p><strong>Height:</strong> {{ clinical_info.Height__cm_ }} cm</p>
            <p><strong>Weight:</strong> {{ clinical_info.Weight__kg_ }} kg</p>
            <p><strong>Race:</strong> {{ clinical_info.Race_Display }}</p>
            <p><strong>CYP2C9:</strong> {{ clinical_info.CYP2C9_Display }}</p>
            <p><strong>VKORC1:</strong> {{ clinical_info.VKORC1_Display }}</p>
        </div>

        <div class="recommendation">
            <h3>Recommended Weekly Dosage</h3>
            <p class="display-4 fw-bold">{{ results.predicted_dose_mg_per_week }} mg/week</p>
        </div>

        <h5 class="section-title">Analysis Details</h5>
        <div class="info-grid">
            <p><strong>Model Used:</strong> {{ results.model_used }}</p>
            <p><strong>Prediction Confidence:</strong> <span class="fw-bold">{{ results.confidence_score }}</span></p>
        </div>
        <p class="mt-2 text-muted">{{ results.confidence_explanation }}</p>
        
        <h5 class="section-title">Explanation of Key Factors</h5>
        <ul>
            {% for explanation in results.human_explanation %}
                <li>{{ explanation | safe }}</li>
            {% endfor %}
        </ul>

        <div class="suggestions">
            <h5 class="section-title" style="margin-top: 0;"><i class="fas fa-lightbulb me-2"></i>Actionable Suggestions</h5>
            <ul>
            {% for suggestion in results.clinical_suggestions %}
                <li>{{ suggestion | safe }}</li>
            {% endfor %}
            </ul>
        </div>

        <div class="disclaimer">
            This AI-generated report is for clinical decision-support only and does not replace professional medical advice.
        </div>
        
        <div class="text-center no-print">
            <form action="{{ url_for('download_report') }}" method="POST">
                {% for key, value in request.form.items() %}
                    <input type="hidden" name="{{ key }}" value="{{ value }}">
                {% endfor %}
                <button type="submit" class="btn btn-success btn-lg"><i class="fas fa-download me-2"></i>Download as PDF</button>
            </form>
        </div>
    </div>
    
    </body>
</html>

<!--<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dosage Recommendation Report — GenMedix</title>

    Bootstrap & Font Awesome 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    AOS for scroll animations
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">

    JsBarcode and QRCode.js
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root{
            --brand-orange: #ff7a00;
            --bg-dark: #0d0d0d;
            --panel-bg: rgba(255,255,255,0.85);
            --glass-border: rgba(255,122,0,0.18);
        }

        body {
            background: linear-gradient(180deg, #0b0b0b 0%, #151515 40%), #f4f6f9;
            min-height: 100vh;
            color: #222;
            font-family: system-ui, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            padding: 30px 18px;
        }

        .report-wrap {
            max-width: 980px;
            margin: 24px auto;
            position: relative;
        }

        /* Card (glass) */
        .report-card {
            background: var(--panel-bg);
            border-radius: 14px;
            padding: 28px;
            box-shadow: 0 8px 30px rgba(10,10,10,0.45);
            backdrop-filter: blur(6px) saturate(120%);
            border: 1px solid var(--glass-border);
            overflow: hidden;
            transition: transform .35s ease, box-shadow .35s ease;
        }
        .report-card:hover { transform: translateY(-6px); box-shadow: 0 18px 60px rgba(255,122,0,0.12); }

        /* Header */
        .report-header {
            display: flex;
            align-items: center;
            gap: 18px;
            justify-content: space-between;
        }
        .brand {
            display:flex;
            align-items:center;
            gap:12px;
        }
        .brand img { height:48px; width:auto; object-fit:contain; display:block; }
        .brand h1 { margin:0; font-size:1.25rem; color:var(--brand-orange); font-weight:700; letter-spacing:0.6px; font-family: "Segoe UI", Roboto, sans-serif; }
        .report-meta { text-align:right; color:#6b6b6b; font-size:0.95rem; }

        /* Section titles */
        .section-title {
            display:inline-block;
            margin: 18px 0 10px 0;
            padding-bottom:6px;
            font-weight:700;
            color: #222;
            border-bottom: 2px solid rgba(255,122,0,0.12);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px 18px;
            align-items: start;
        }
        .info-grid p { margin: 4px 0; color: #222; }

        /* Recommendation */
        .recommendation {
            background: linear-gradient(90deg, rgba(255,122,0,0.06), rgba(255,122,0,0.02));
            border-left: 5px solid var(--brand-orange);
            padding: 18px;
            margin-top: 16px;
            text-align: center;
            border-radius: 8px;
        }
        .recommendation .dose { color: var(--brand-orange); font-size: 2.1rem; font-weight:800; }

        /* Suggestions */
        .suggestions {
            background: linear-gradient(90deg, rgba(255,238,204,0.6), rgba(255,255,255,0.5));
            border-left: 5px solid #ffc107;
            padding: 14px;
            margin-top: 18px;
            border-radius:8px;
        }

        /* Barcode / QR area */
        .id-block {
            display:flex;
            gap: 18px;
            align-items:center;
            justify-content: space-between;
            margin-top: 18px;
            flex-wrap:wrap;
        }
        .barcode-wrap, .qr-wrap {
            background: #fff;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 6px 18px rgba(10,10,10,0.06);
            display:flex;
            align-items:center;
            gap:12px;
        }
        .barcode-wrap svg, .qr-wrap canvas { display:block; }

        .patient-id { font-weight:700; color:#111; font-size:0.95rem; }

        /* Signature placeholder */
        .signature {
            margin-top: 26px;
            display:flex;
            gap: 20px;
            align-items:flex-start;
        }
        .signature .sig-box {
            flex: 1 1 60%;
            min-height: 88px;
            border-bottom: 2px dashed rgba(0,0,0,0.12);
            background: linear-gradient(180deg, rgba(255,255,255,0.0), rgba(255,255,255,0.02));
            border-radius: 6px;
            padding: 10px;
        }
        .signature .sig-info {
            flex: 0 0 35%;
            font-size:0.9rem;
            color:#444;
        }
        .sig-label { font-weight:700; color:#222; margin-bottom:8px; }

        /* Floating download button */
        .floating-download {
            position: fixed;
            right: 22px;
            bottom: 24px;
            z-index: 1200;
            border-radius: 50px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.35);
            transition: transform .18s ease;
        }
        .floating-download button { border-radius: 50px; padding: 12px 18px; font-weight:700; background:var(--brand-orange); border:none; color:#fff; }
        .floating-download:hover { transform: translateY(-6px) scale(1.02); }

        /* Hide floating action in print */
        @media print {
            .floating-download, .no-print { display:none !important; }
            body { background: white !important; }
            .report-card { box-shadow:none; border: none; background: white; }
        }

        /* small screens */
        @media (max-width:720px){
            .info-grid { grid-template-columns: 1fr; }
            .report-header { flex-direction: column; gap:10px; align-items:flex-start; }
            .id-block { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="report-wrap">
        <div class="report-card" data-aos="fade-up" data-aos-duration="900">
            <div class="report-header">
                <div class="brand">
                    Use static file; save your logo to static/genmedix_logo.png 
                    <img src="{{ url_for('static', filename='assets/images/image.png') }}" alt="GenMedix Logo" />
                    <div>
                        <h1>GenMedix</h1>
                        <div style="font-size:0.92rem; color:#666;">Dosage Recommendation Report</div>
                    </div>
                </div>

                <div class="report-meta">
                    <div><strong>Date:</strong> {{ results.generated_at if results.generated_at else (request.date or "") }}</div>
                    <div style="margin-top:6px; color:#a0a0a0; font-size:0.9rem;">Report ID:
                        <span class="patient-id">
                            {{ results.report_id or (patient_info.patient_name ~ '_' ~ patient_info.patient_dob) }}
                        </span>
                    </div>
                </div>
            </div>

            Patient Information
            <h5 class="section-title" data-aos="fade-right">Patient Information</h5>
            <div class="info-grid" data-aos="fade-up" data-aos-duration="700">
                <p><strong>Name:</strong> {{ patient_info.patient_name }}</p>
                <p><strong>DOB:</strong> {{ patient_info.patient_dob }}</p>
                <p><strong>Gender:</strong> {{ patient_info.patient_gender }}</p>
                <p><strong>Country:</strong> {{ patient_info.patient_country }}</p>
            </div>

            Clinical & Genomic Data
            <h5 class="section-title" data-aos="fade-right">Clinical & Genomic Data Provided</h5>
            <div class="info-grid" data-aos="fade-up" data-aos-duration="700">
                <p><strong>Age:</strong> {{ clinical_info.Age }} years</p>
                <p><strong>Height:</strong> {{ clinical_info.Height__cm_ }} cm</p>
                <p><strong>Weight:</strong> {{ clinical_info.Weight__kg_ }} kg</p>
                <p><strong>Race:</strong> {{ clinical_info.Race_Display }}</p>
                <p><strong>CYP2C9:</strong> {{ clinical_info.CYP2C9_Display }}</p>
                <p><strong>VKORC1:</strong> {{ clinical_info.VKORC1_Display }}</p>
            </div>

            Recommendation
            <div class="recommendation" data-aos="zoom-in" data-aos-duration="700">
                <h3 style="margin:0 0 6px 0;">Recommended Weekly Dosage</h3>
                <div class="dose">{{ results.predicted_dose_mg_per_week }} mg/week</div>
            </div>

            Analysis details
            <h5 class="section-title" data-aos="fade-right">Analysis Details</h5>
            <div class="info-grid" data-aos="fade-up">
                <p><strong>Model Used:</strong> {{ results.model_used }}</p>
                <p><strong>Prediction Confidence:</strong> <span class="fw-bold">{{ results.confidence_score }}</span></p>
            </div>
            <p class="mt-2 text-muted" data-aos="fade-up">{{ results.confidence_explanation }}</p>

            Explanation list
            <h5 class="section-title" data-aos="fade-right">Explanation of Key Factors</h5>
            <ul data-aos="fade-up">
                {% for explanation in results.human_explanation %}
                    <li>{{ explanation | safe }}</li>
                {% endfor %}
            </ul>

            Suggestions
            <div class="suggestions" data-aos="fade-up">
                <h5 style="margin-top:0; margin-bottom:6px;"><i class="fas fa-lightbulb me-2"></i>Actionable Suggestions</h5>
                <ul>
                    {% for suggestion in results.clinical_suggestions %}
                        <li>{{ suggestion | safe }}</li>
                    {% endfor %}
                </ul>
            </div>

            Barcode & QR + Patient ID 
            <div class="id-block" data-aos="fade-up" data-aos-duration="700">
                <div class="barcode-wrap" style="align-items:center;">
                    <div>
                        <svg id="barcode"></svg>
                    </div>
                    <div style="min-width:160px;">
                        <div style="font-size:0.8rem; color:#666;">Patient / Report ID</div>
                        <div class="patient-id">
                            {{ results.report_id or (patient_info.patient_name ~ '_' ~ patient_info.patient_dob) }}
                        </div>
                    </div>
                </div>

                <div class="qr-wrap" style="align-items:center;">
                    <div id="qrcode"></div>
                    <div style="font-size:0.85rem; color:#666;">Scan to verify report</div>
                </div>
            </div>

            Doctor signature
            <div class="signature" data-aos="fade-up">
                <div class="sig-box" aria-label="Doctor signature placeholder">
                    <div class="sig-label">Doctor's Signature</div>
                    <div style="color:#777; font-size:0.9rem;">(Please sign here)</div>
                </div>
                <div class="sig-info">
                    <div style="font-weight:700; margin-bottom:8px;">Doctor Details</div>
                    <div style="color:#555; font-size:0.95rem;">
                        Name: ___________________________<br>
                        Reg. No: _________________________<br>
                        Date: ___________________________
                    </div>
                </div>
            </div>

            Disclaimer
            <div style="margin-top:20px; color:#6c757d; font-size:0.9rem; text-align:center;">
                This AI-generated report is for clinical decision-support only and does not replace professional medical advice.
            </div>

            Original download form (kept intact)
            <div class="text-center no-print" style="margin-top:18px;">
                <form action="{{ url_for('download_report') }}" method="POST">
                    {% for key, value in request.form.items() %}
                        <input type="hidden" name="{{ key }}" value="{{ value }}">
                    {% endfor %}
                    <button type="submit" class="btn btn-outline-dark btn-lg">
                        <i class="fas fa-download me-2"></i>Download as PDF
                    </button>
                </form>
            </div>
        </div>
    </div>

     Floating Download (fixed) — posts same hidden fields as original form 
    <div class="floating-download no-print" role="button" title="Download report as PDF">
        <form id="floatDownloadForm" action="{{ url_for('download_report') }}" method="POST">
            {% for key, value in request.form.items() %}
                <input type="hidden" name="{{ key }}" value="{{ value }}">
            {% endfor %}
            <button type="submit" class="btn"><i class="fas fa-file-pdf me-2"></i>Download PDF</button>
        </form>
    </div>

    AOS + helper scripts
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script>
        AOS.init({ once: true, duration: 700 });
    </script>

    <script>
        // Use a stable reportId value (Jinja) — don't change server-side data.
        const reportId = "{{ results.report_id or (patient_info.patient_name ~ '_' ~ patient_info.patient_dob) }}";

        // Generate barcode (JsBarcode using an SVG element)
        document.addEventListener('DOMContentLoaded', function(){
            try {
                JsBarcode("#barcode", reportId, {
                    format: "CODE128",
                    displayValue: true,
                    fontSize: 14,
                    height: 40,
                    margin: 6
                });
            } catch (e) {
                console.warn("Barcode generation failed:", e);
            }

            // Generate QR Code
            try {
                // Clear previous if exists
                const qnode = document.getElementById('qrcode');
                qnode.innerHTML = '';
                new QRCode(qnode, {
                    text: reportId,
                    width: 96,
                    height: 96,
                    correctLevel: QRCode.CorrectLevel.M
                });
            } catch (e) {
                console.warn("QR generation failed:", e);
            }
        });
    </script>
</body>
</html>-->
